<h3 id="background">Background</h3>
<p><a href="https://www.python.org/">Python</a> 作为一个高级编程语言 (high-level language)，它的主要工作是将用户编写的 Python 源代码解释成机器能理解的成字节码 (bytecode)，以便让机器执行指令。</p>

<p>相比于机器语言和汇编语言等低级语言 (low-level language)，使用高级编程语言编写代码有一些好处：代码更少也更易读，编写代码所需的时间更短；更容易做到跨平台运行。</p>

<p>安装 Python 时，它很重要的一个组件是 Python Interpreter。解释器的主要工作是解释并运行 Python: 读取用户编写的 Python 源代码；对源代码进行词法分析，将代码分解成词法单元（tokens）；之后进行语法分析，构建抽象语法树（Abstract Syntax Tree，AST）来表示代码的结构；接着将抽象语法树编译成 bytecode，这是一种中间形式的代码；最后，Python 解释器会逐行执行字节码指令，将其转换为机器码并执行，实现源代码的功能。</p>

<p>执行 Python 有两种模式：<strong>immediate mode</strong> &amp; <strong>script mode</strong>. 前者是在 terminal 界面进入 Python 解释器的窗口进行即时交互；第二种是通过编写扩展名为 <strong>py</strong> 的 Python 脚本，使用 Python 解释器去执行该脚本。</p>

<p>在日常调试和数据分析过程中，另一个常用的 python 交互方式是 <a href="https://jupyter.org/">Jupiter Notebook</a>。</p>

<h3 id="installation">Installation</h3>
<p>根据操作系统不同，安装 Python 的方式有很多，详情可以参考 <a href="https://www.python.org/downloads/">Downlaod Python</a>。笔者推荐使用 <a href="https://www.anaconda.com/download/success">Anaconda</a> 作为 Python 的环境管理工具。</p>

<p>检验 Python 环境配置是否已经完成：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python <span class="nt">--version</span>
</code></pre></div></div>

<h3 id="data-type">Data Type</h3>
<p>Python 中常见的数据类型包括：</p>

<ol>
  <li>整数（int）：表示整数值，如 5、-3;</li>
  <li>浮点数（float）：表示带有小数点的数值，如 3.14、-0.001;</li>
  <li>字符串（str）：表示文本数据，如 ‘hello’、”world”;</li>
  <li>布尔值（bool）：表示逻辑值，只有两个取值：True 和 False;</li>
  <li>列表（list）：有序、可变的集合，如 [1, 2, 3];</li>
  <li>元组（tuple）：有序、不可变的集合，如 (1, 2, 3);</li>
  <li>集合（set）：无序、不重复的集合，如 {1, 2, 3};</li>
  <li>字典（dict）：无序的键值对集合，如 {‘name’: ‘Alice’, ‘age’: 30}。</li>
</ol>

<h3 id="script-structure">Script Structure</h3>
<p>在生产级别的 Python 编程中，一个 Python 脚本通常由以下部分构成：</p>

<p><strong>1. 导入模块</strong></p>

<p>在开头导入代码所需的模块，以扩展 Python 的功能和复用代码。例如：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">os</span>
<span class="kn">import</span> <span class="n">sys</span>
<span class="kn">from</span> <span class="n">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
</code></pre></div></div>
<p>注：你可以在 <a href="https://docs.python.org/3/library/">Python 标准库</a>, <a href="https://pypi.org/">PyPI (Python Package Index)</a>, <a href="https://awesome-python.com/">Awesome Python</a> 找到丰富的 Python 库及其功能详情；也可以使用 <code class="language-plaintext highlighter-rouge">help(function_name)</code> 可以查看已导入方法内置的说明。</p>

<p><strong>2. 全局变量和常量定义</strong></p>

<p>定义全局变量和常量，用于在整个脚本中共享数据。例如：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">MAX_RETRIES</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">DEBUG_MODE</span> <span class="o">=</span> <span class="bp">True</span>
</code></pre></div></div>

<p><strong>3. 函数和类定义</strong></p>

<p>编写函数和类来组织代码逻辑和实现功能。函数用于封装可重复使用的代码块，类用于组织相关属性和方法。例如：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">calculate_area</span><span class="p">(</span><span class="n">radius</span><span class="p">):</span>
    <span class="k">return</span> <span class="mf">3.14</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">**</span> <span class="mi">2</span>

<span class="k">class</span> <span class="nc">Person</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">self</span><span class="p">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span>
</code></pre></div></div>

<p>注：其中 <code class="language-plaintext highlighter-rouge">__init__</code> 是 Python 中的构造函数，用于在创建对象时初始化对象的属性。</p>

<p><strong>4. 主程序逻辑</strong></p>

<p>编写主要的程序逻辑，包括流程控制、数据处理、调用函数等。这部分代码通常位于脚本的最顶层，用于实现脚本的主要功能。例如：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="n">radius</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">area</span> <span class="o">=</span> <span class="nf">calculate_area</span><span class="p">(</span><span class="n">radius</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">The area of the circle is: </span><span class="si">{</span><span class="n">area</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<p>注：<code class="language-plaintext highlighter-rouge">if __name__ == "__main__"</code> 被用来判断当前脚本是否作为主程序运行，加上这段代码可以防止在被其他脚本导入时执行了不必要的代码；当 Python 解释器运行一个脚本时，<code class="language-plaintext highlighter-rouge">__name__</code> 变量会被设置为 <code class="language-plaintext highlighter-rouge">"__main__"</code>，而如果该脚本被作为模块导入到其他脚本时，<code class="language-plaintext highlighter-rouge">__name__</code> 变量会被设置为模块的名称。</p>

<p><strong>5. 异常处理</strong></p>

<p>添加适当的异常处理机制，以处理可能出现的错误和异常情况，确保程序的稳定性和可靠性。例如：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">try</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">/</span> <span class="mi">0</span>
<span class="k">except</span> <span class="nb">ZeroDivisionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Error: Division by zero!</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>
<p>注：可以通过 <a href="https://docs.python.org/3/library/exceptions.html">Python 异常文档</a> 查看完整的 Exception 列表，也可以通过 <code class="language-plaintext highlighter-rouge">help(ExceptionNameError)</code> 查看特定异常的详细信息。</p>

<p><strong>6. 日志记录</strong></p>

<p>使用日志记录模块记录程序运行时的信息、警告和错误，以便进行故障排查和监控。例如：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">logging</span>
<span class="n">logging</span><span class="p">.</span><span class="nf">basicConfig</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="sh">'</span><span class="s">app.log</span><span class="sh">'</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="p">.</span><span class="n">INFO</span><span class="p">)</span>
<span class="n">logging</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sh">'</span><span class="s">Program started</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="useful-libraries">Useful Libraries</h3>
<p><strong>1. <a href="https://docs.python.org/3/library/pdb.html">pdb</a> —— The Python Debugger</strong></p>

<p>pdb 是一个 python 中用于调试代码的模块，它的用法有两种，在代码行中插入：</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">pdb</span><span class="p">;</span> <span class="n">pdb</span><span class="p">.</span><span class="nf">set_trace</span><span class="p">()</span>
</code></pre></div></div>
<p>或者使用 python3.7 之后内置的 <code class="language-plaintext highlighter-rouge">breakpoint()</code></p>

<p><strong>Example: Debug Guessing Number</strong></p>

<p>random.randint(a, b) 返回一个 a &lt;= N &lt;= b 的随机整型，用 Python 执行下面的脚本得不到我们想要的结果。使用 breakpoint() 来寻找原因。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># import pdb
</span><span class="kn">from</span> <span class="n">random</span> <span class="kn">import</span> <span class="n">randint</span>

<span class="c1"># pdb.set_trace()
</span><span class="nf">breakpoint</span><span class="p">()</span>
<span class="n">answer</span> <span class="o">=</span> <span class="nf">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="nf">input</span><span class="p">(</span><span class="sh">"</span><span class="s">Guess: 0 or 1?</span><span class="sh">"</span><span class="p">)</span>
<span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="n">answer</span><span class="p">:</span>
    <span class="nf">breakpoint</span><span class="p">()</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Correct!</span><span class="sh">"</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nf">breakpoint</span><span class="p">()</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Incorrect. The answer was </span><span class="si">{</span><span class="n">answer</span><span class="si">}</span><span class="s">.</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-&gt; answer <span class="o">=</span> randint<span class="o">(</span>0, 1<span class="o">)</span>
<span class="o">(</span>Pdb<span class="o">)</span> n
-&gt; n <span class="o">=</span> input<span class="o">(</span><span class="s2">"Guess: 0 or 1?"</span><span class="o">)</span>
<span class="o">(</span>Pdb<span class="o">)</span> <span class="o">!</span>answer
1
<span class="o">(</span>Pdb<span class="o">)</span> n
Guess: 0 or 1?1
-&gt; <span class="k">if </span>n <span class="o">==</span> answer:
<span class="o">(</span>Pdb<span class="o">)</span> <span class="k">continue</span>
-&gt; print<span class="o">(</span>f<span class="s2">"Incorrect. The answer was {answer}."</span><span class="o">)</span>
<span class="o">(</span>Pdb<span class="o">)</span> <span class="o">!(</span>n <span class="o">==</span> answer<span class="o">)</span>
False
<span class="o">(</span>Pdb<span class="o">)</span> <span class="o">!</span><span class="nb">type</span><span class="o">(</span>n<span class="o">)</span>
&lt;class <span class="s1">'str'</span><span class="o">&gt;</span>
<span class="o">(</span>Pdb<span class="o">)</span> <span class="o">!</span><span class="nb">type</span><span class="o">(</span>answer<span class="o">)</span>
&lt;class <span class="s1">'int'</span><span class="o">&gt;</span>
<span class="o">(</span>Pdb<span class="o">)</span> <span class="k">continue
</span>Incorrect. The answer was 1.
</code></pre></div></div>

<p>通过 debug 发现，比较时变量 n 和变量 answer 类型不同，将第 7 行代码按如下调整即可修复功能：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">n</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="nf">input</span><span class="p">(</span><span class="sh">"</span><span class="s">Guess: 0 or 1?</span><span class="sh">"</span><span class="p">))</span>
</code></pre></div></div>

<p>在 debug 模式下，键入 <code class="language-plaintext highlighter-rouge">help</code> 查看可以使用的所有命令，以下是开发中最常用的命令及其说明：</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">pdb Command</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">n or next</td>
      <td>Run the next line of code</td>
    </tr>
    <tr>
      <td style="text-align: left">s or step</td>
      <td>Step into current line(usually a function call)</td>
    </tr>
    <tr>
      <td style="text-align: left">r or return</td>
      <td>Return from the current function</td>
    </tr>
    <tr>
      <td style="text-align: left">l or list</td>
      <td>List the surrounding code lines</td>
    </tr>
    <tr>
      <td style="text-align: left">interact</td>
      <td>Starts an interactive Python interpreter</td>
    </tr>
    <tr>
      <td style="text-align: left">c or continue</td>
      <td>Continue running (until next breakpoint or exit)</td>
    </tr>
    <tr>
      <td style="text-align: left">b or break</td>
      <td>Set a breakpoint for a specific line or function</td>
    </tr>
    <tr>
      <td style="text-align: left">!</td>
      <td>Special prefix to say “run this as Python code”</td>
    </tr>
    <tr>
      <td style="text-align: left">pp</td>
      <td>Pretty-print the value of a Python expression</td>
    </tr>
  </tbody>
</table>

<p>To be continued…</p>
